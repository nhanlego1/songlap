<?php
/**
 * Created by JetBrains PhpStorm.
 * User: nhan
 * Date: 1/15/15
 * Time: 7:53 AM
 * To change this template use File | Settings | File Templates.
 */



/**
 * Implement hook_block
 */
function merc_global_block_info() {

    $blocks['admin_panel'] = array(
        'info' => t('Admin Panel'),
    );
    $blocks['songlap_year'] = array(
        'info' => t('Year category'),
    );

    return $blocks;
}

/*
 * Hook Block View
 */
function merc_global_block_view($delta = '') {
    $block = array();

    switch($delta) {
        case 'admin_panel':
            $block['subject'] = '';
            $block['content'] = merc_global_admin_dashboard();
            break;
        case 'songlap_year':
            $block['subject'] = t('Project by year');
            $block['content'] = merc_year_filter();
            break;

    }
    return $block;
}


/*
 * Implement hook_theme
 */

function merc_global_theme() {
    return array(
        'merc_global_panel' => array(
            'render element' => 'element',
            'template' => 'theme/merc-global-panel',
        ),

    );
}

function merc_global_admin_dashboard(){
    global $user;
    drupal_add_css(drupal_get_path('module','merc_global').'/admin_panel/admin-panel.css');
    return array('#theme' => 'merc_global_panel');
}

/*
 *
 */
function merc_year_filter(){
    $tid = arg(2);
    $curr_term = taxonomy_term_load($tid);
    $terms = taxonomy_get_tree(4);
    $output = '';
    $output .='<ul class="year-category">';
    foreach($terms as $term){
       if($curr_term->vid==2){
         if($term->tid==$tid){
             $output .='<li><a class="active" href="'.url('taxonomy/term/'.$term->tid,array('query'=>array('cate'=>$tid))).'">'.$term->name.'</a></li>';
         }
         else{
             $output .='<li><a href="'.url('taxonomy/term/'.$term->tid,array('query'=>array('cate'=>$tid))).'">'.$term->name.'</a></li>';
         }

       }elseif(isset($_GET['cate'])){
            if($tid==$term->tid){
                $output .='<li><a class="active" href="'.url('taxonomy/term/'.$term->tid,array('query'=>array('cate'=>$_GET['cate']))).'">'.$term->name.'</a></li>';
            }else{
                $output .='<li><a href="'.url('taxonomy/term/'.$term->tid,array('query'=>array('cate'=>$_GET['cate']))).'">'.$term->name.'</a></li>';
            }

        }else{
           $output .='<li><a href="'.url('taxonomy/term/'.$term->tid).'">'.$term->name.'</a></li>';
       }

    }
    $output .='</ul>';
    return $output;
}